<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>VisionLap RC Dashboard</title>
     <!-- Tailwind CDN para desarrollo -->
     <script src="https://cdn.tailwindcss.com"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
     <style>
         .lap-time-display { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.25rem; color: #f59e0b; }
         /* Peque√±as reglas para el feed de v√≠deo (tailwind no gestiona contenido inline) */
         .video-feed { width: 100%; height: auto; display: block; }
     </style>
</head>
<body>
    <header class="bg-gray-900 text-white p-4 mb-6">
        <div class="container mx-auto">
            <div class="flex items-center">
                <span class="text-xl font-semibold">üèÅ VisionLap RC</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-6">
            <div class="lg:w-1/3 w-full">
                <div class="bg-gray-800 rounded-lg p-4 mb-4 shadow">
                    <h5 class="text-gray-100 font-medium mb-3">C√°mara en Vivo</h5>
                    <div id="videoWrap" class="relative border-2 border-gray-700 rounded overflow-hidden bg-black">
                        <img id="videoFeed" src="{{ url_for('video_feed') }}" class="video-feed" alt="Esperando Video...">
                        <div id="detectorOverlay" class="absolute inset-0 flex items-center justify-center bg-black/60 text-white text-lg font-semibold hidden">
                            Detector detenido
                        </div>
                    </div>
                    <div class="mt-3 flex items-center gap-3">
                        <button id="detectorToggle" class="px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded">Activar detector</button>
                        <div id="detectorStatus" class="text-sm text-gray-300">Estado: desconocido</div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <button onclick="startSession()" class="bg-green-600 hover:bg-green-700 text-white py-2 rounded">Iniciar Carrera</button>
                        <button onclick="stopSession()" class="bg-red-600 hover:bg-red-700 text-white py-2 rounded">Detener</button>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-4 shadow">
                    <h5 class="text-gray-100 font-medium mb-3">Gesti√≥n de Pilotos</h5>
                    <form id="driverForm" class="space-y-3">
                        <input type="text" id="dName" placeholder="Nombre" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100" />
                        <input type="text" id="dNick" placeholder="Nickname (3 letras)" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100" />
                        <input type="number" id="dTag" placeholder="Tag ID (0-29)" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100" />
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">Registrar</button>
                    </form>
                    <div class="mt-4">
                        <h6 class="text-gray-200 font-medium mb-2">Pilotos registrados</h6>
                        <div class="flex items-center gap-2 mb-2">
                            <input id="driversSearch" type="text" placeholder="Buscar piloto..." class="flex-1 px-3 py-2 rounded bg-gray-700 text-gray-100 text-sm" />
                            <button id="driversReload" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm">Buscar</button>
                        </div>
                        <ul id="driversList" class="space-y-2 text-gray-200 text-sm">
                            <!-- Items se insertan desde JS -->
                        </ul>
                        <div class="mt-3 flex items-center justify-between text-sm text-gray-400">
                            <div id="driversPagerInfo"></div>
                            <div class="space-x-2">
                                <button id="driversPrev" class="px-2 py-1 bg-gray-700 rounded">‚óÄ</button>
                                <button id="driversNext" class="px-2 py-1 bg-gray-700 rounded">‚ñ∂</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:w-2/3 w-full">
                <div class="bg-gray-800 rounded-lg p-4 shadow">
                    <h3 class="text-center text-gray-100 mb-4">Tabla de Posiciones</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-gray-200">
                            <thead class="text-gray-400 text-sm uppercase">
                                <tr>
                                    <th class="px-4 py-2">Pos</th>
                                    <th class="px-4 py-2">Piloto</th>
                                    <th class="px-4 py-2">Vueltas</th>
                                    <th class="px-4 py-2">√öltima</th>
                                    <th class="px-4 py-2">Mejor</th>
                                    <th class="px-4 py-2">Gap</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody" class="divide-y divide-gray-700">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>