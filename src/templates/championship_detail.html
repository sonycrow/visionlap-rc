{% extends 'layout.html' %}

{% block content %}
<div class="p-4 w-full">
    <h2 class="text-2xl font-bold mb-4">{{ championship.name }}</h2>
    <p class="text-sm text-gray-400 mb-4">{{ championship.description }}</p>

    <div class="mb-4">
        <h3 class="text-lg font-semibold mb-2">Temporadas</h3>
        <form id="createSeasonForm" class="flex gap-2 mb-3">
            <input id="seasonName" placeholder="Nombre temporada (p.ej. 2025)" class="px-3 py-2 rounded bg-gray-700 text-white" />
            <input id="seasonYear" type="number" placeholder="Año" class="px-3 py-2 rounded bg-gray-700 text-white w-28" />
            <button type="submit" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded text-white">Crear temporada</button>
        </form>

        <div class="grid gap-2">
            {% for s in seasons %}
                <a href="/seasons/{{ s.id }}" class="block p-3 bg-gray-800 rounded hover:bg-gray-700">{{ s.name }} {% if s.year %} — {{ s.year }}{% endif %}</a>
            {% else %}
                <div class="text-gray-400">No hay temporadas en este campeonato.</div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
const createSeasonForm = document.getElementById('createSeasonForm');
createSeasonForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('seasonName').value.trim();
    const year = parseInt(document.getElementById('seasonYear').value) || null;
    if (!name) return alert('Nombre necesario');
    const resp = await fetch('/api/seasons', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ championship_id: {{ championship.id }}, name, year }) });
    const data = await resp.json();
    if (resp.ok) location.reload();
    else alert('Error: ' + (data.error || resp.statusText));
});
</script>

{% endblock %}
